    <script type="module">
        // Importando vers√£o compat√≠vel e est√°vel do Firebase (v10)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, where, getDocs, orderBy, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // SUA CONFIGURA√á√ÉO DO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyARC963xbif9HN43w7MJxLXE2VlEBDXZ0U",
            authDomain: "uber-gestao.firebaseapp.com",
            projectId: "uber-gestao",
            storageBucket: "uber-gestao.firebasestorage.app",
            messagingSenderId: "615548282513",
            appId: "1:615548282513:web:89db20f983e7d4eea5c130"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- VARI√ÅVEIS GLOBAIS ---
        let currentUser = null;
        let localData = []; // Cache local dos dados do Firestore
        
        // Vari√°veis da UI (Mantidas do seu c√≥digo original)
        const steps = [
            { id: 'customDate', title: 'Data', icon: 'üìÖ', label: 'Qual a data do registro?', type: 'date' },
            { id: 'uber', title: 'Ganhos Uber', icon: 'üöó', label: 'Valor total feito na Uber', type: 'number' },
            { id: 'pop', title: 'Ganhos 99', icon: 'üöï', label: 'Valor total na 99/Indriver', type: 'number' },
            { id: 'rentPaid', title: 'Aluguel (Hoje)', icon: 'üü£', label: 'Quanto separou hoje?', type: 'number' },
            { id: 'fuel', title: 'Combust√≠vel', icon: '‚õΩ', label: 'Total gasto no posto', type: 'number' },
            { id: 'food', title: 'Alimenta√ß√£o', icon: 'üçî', label: 'Lanches e Refei√ß√µes', type: 'number' },
            { id: 'km', title: 'KM Rodados', icon: 'üõ£Ô∏è', label: 'Quilometragem do dia', type: 'number' },
            { id: 'hours', title: 'Horas Online', icon: '‚è±Ô∏è', label: 'Tempo Conectado (HH:MM)', type: 'time' },
            { id: 'rides', title: 'Viagens', icon: 'üî¢', label: 'Quantidade de corridas', type: 'number' }
        ];
        const monthNames = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        let currentStep = 0, tempData = {}, viewDate = new Date(), editingIndex = null;
        let tempOffDays = []; 
        let rentCalendarDate = new Date(); 
        let itemToDeleteIndex = null;
        window.isRegisterMode = false;

        // --- FUN√á√ïES DE AUTH E FIREBASE ---
        
        // 1. Monitorar Login e Carregar Dados
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('view-dashboard').classList.remove('hidden');
                await loadFirebaseData(); // Carrega os dados da nuvem
            } else {
                currentUser = null;
                localData = [];
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('view-dashboard').classList.add('hidden');
            }
        });

        // 2. Fun√ß√£o para Carregar Dados do Firestore (READ)
        async function loadFirebaseData() {
            if(!currentUser) return;
            
            // Feedback visual simples
            document.getElementById('dash-profit').innerText = "...";
            
            try {
                const q = query(
                    collection(db, "usuarios", currentUser.uid, "registros"), 
                    orderBy("timestamp", "desc") // Ordena do mais recente
                );

                const querySnapshot = await getDocs(q);
                localData = []; // Limpa cache local
                
                querySnapshot.forEach((doc) => {
                    let d = doc.data();
                    d.docId = doc.id; // Salva o ID do Firestore para poder editar/apagar depois
                    localData.push(d);
                });

                // Atualiza a tela com os dados novos
                window.renderDashboard();
                window.renderHistory();

            } catch (error) {
                console.error("Erro ao buscar dados:", error);
                alert("Erro ao carregar dados. Verifique sua conex√£o.");
            }
        }

        // 3. Fun√ß√£o Login/Cadastro
        window.handleAuthAction = async function() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            const btn = document.getElementById('btn-main-action');

            if(!email || !pass) { alert("Preencha e-mail e senha!"); return; }

            btn.innerText = "Processando...";
            btn.disabled = true;

            try {
                if (window.isRegisterMode) {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                    await setDoc(doc(db, "usuarios", userCredential.user.uid), { 
                        email: email, 
                        criadoEm: new Date().toISOString() 
                    });
                    alert("Conta criada!");
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                }
            } catch (error) {
                console.error(error);
                let msg = "Erro ao entrar.";
                if(error.code === 'auth/invalid-credential') msg = "Dados incorretos.";
                if(error.code === 'auth/email-already-in-use') msg = "E-mail j√° cadastrado.";
                alert(msg);
                btn.disabled = false;
                btn.innerText = window.isRegisterMode ? "CRIAR CONTA" : "ENTRAR";
            }
        }

        // --- INTEGRA√á√ÉO COM A L√ìGICA ANTIGA ---

        // Substitui o antigo getDB para ler da vari√°vel carregada do Firebase
        window.getDB = function() { 
            return localData; 
        }

        // Nova fun√ß√£o Save que escreve no Firebase (CREATE / UPDATE)
        window.saveEntry = async function() {
            if(!currentUser) return;

            // Prepara os dados
            const d = new Date(tempData.customDate+'T12:00:00');
            tempData.date = d.toLocaleDateString('pt-BR'); 
            tempData.month = d.getMonth(); 
            tempData.year = d.getFullYear();
            
            if(tempData.rentPaid === undefined) tempData.rentPaid = 0;

            const btnNext = document.getElementById('btn-next');
            btnNext.innerText = "Salvando...";
            btnNext.disabled = true;

            try {
                if(editingIndex !== null) {
                    // MODO EDI√á√ÉO
                    const item = localData[editingIndex];
                    if(item && item.docId) {
                        const docRef = doc(db, "usuarios", currentUser.uid, "registros", item.docId);
                        await updateDoc(docRef, tempData);
                    }
                } else {
                    // MODO CRIA√á√ÉO (Novo Registro)
                    tempData.timestamp = Date.now();
                    const collectionRef = collection(db, "usuarios", currentUser.uid, "registros");
                    await addDoc(collectionRef, tempData);
                }

                // Recarrega tudo para garantir sincronia
                await loadFirebaseData();
                
                toggleWizard(false);
                if(editingIndex !== null) {
                   closeDayDetail(); // Fecha detalhes se estava editando
                }

            } catch(e) {
                console.error(e);
                alert("Erro ao salvar: " + e.message);
            } finally {
                btnNext.innerText = "SALVAR";
                btnNext.disabled = false;
            }
        }

        // Nova fun√ß√£o Delete que remove do Firebase (DELETE)
        window.confirmDelete = async function() {
            if(itemToDeleteIndex !== null && currentUser) {
                const item = localData[itemToDeleteIndex];
                
                if(item && item.docId) {
                    try {
                        const btn = document.querySelector('.btn-danger'); // Bot√£o apagar visual
                        if(btn) btn.innerText = "...";

                        await deleteDoc(doc(db, "usuarios", currentUser.uid, "registros", item.docId));
                        
                        await loadFirebaseData(); // Atualiza UI
                        closeDeleteModal();
                        closeDayDetail();
                    } catch(e) {
                        alert("Erro ao apagar: " + e.message);
                    }
                }
            }
        }

        // --- RESTO DAS FUN√á√ïES DE UI (INTACTAS OU ADAPTADAS) ---

        window.toggleAuthMode = function() {
            window.isRegisterMode = !window.isRegisterMode;
            const btnMain = document.getElementById('btn-main-action');
            const txtToggle = document.getElementById('txt-toggle');
            const btnToggle = document.getElementById('btn-toggle');
            
            if(window.isRegisterMode) {
                btnMain.innerText = "CRIAR CONTA";
                txtToggle.innerText = "J√° tem conta?";
                btnToggle.innerText = "Fazer Login";
            } else {
                btnMain.innerText = "ENTRAR";
                txtToggle.innerText = "N√£o tem conta?";
                btnToggle.innerText = "Criar agora";
            }
        }

        window.onload = function() { 
            window.history.pushState({page: 'home'}, "", ""); 
            window.onpopstate = function(event) { handleBackButton(); };
            // N√£o chamamos renderDashboard aqui direto, esperamos o Auth carregar os dados
        };

        window.handleBackButton = function() {
            if(!document.getElementById('wizard-overlay').classList.contains('hidden')) { toggleWizard(false); return; }
            if(!document.getElementById('view-day-detail').classList.contains('hidden')) { closeDayDetail(); return; }
            if(!document.getElementById('modal-rent').classList.contains('hidden')) { closeRentConfig(); return; }
            if(!document.getElementById('view-history').classList.contains('hidden')) { switchTab('home'); return; }
        }
        window.goBack = function() { window.history.back(); }

        // --- ALUGUEL (Ainda local, mas integrado na visualiza√ß√£o) ---
        window.openRentConfig = function() {
            window.history.pushState({modal: 'rent'}, "", "");
            document.getElementById('modal-rent').classList.remove('hidden');
            const config = JSON.parse(localStorage.getItem('rent_config')) || { total: 0, offDays: [] };
            document.getElementById('input-total-rent').value = config.total || '';
            tempOffDays = (config.offDays || []).map(Number);
            rentCalendarDate = new Date(); 
            renderRentCalendar();
            updateRentPreview();
        }

        window.changeRentMonth = function(dir) {
            rentCalendarDate.setMonth(rentCalendarDate.getMonth() + dir);
            renderRentCalendar();
        }

        window.renderRentCalendar = function() {
            const m = rentCalendarDate.getMonth();
            const y = rentCalendarDate.getFullYear();
            const daysInMonth = new Date(y, m + 1, 0).getDate();
            const container = document.getElementById('rent-calendar');
            document.getElementById('cal-month-title').innerText = `${monthNames[m]} ${y}`;
            container.innerHTML = '';

            const db = getDB(); // Pega do cache local atualizado
            const today = new Date();

            for (let i = 1; i <= daysInMonth; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'cal-day';
                dayDiv.innerText = i;
                
                const currentDate = new Date(y, m, i);
                const isPast = currentDate < new Date(today.getFullYear(), today.getMonth(), today.getDate());
                
                if (isPast) {
                    const checkDateStr = `${i.toString().padStart(2, '0')}/${(m+1).toString().padStart(2, '0')}/${y}`;
                    const hasRecord = db.some(item => item.date === checkDateStr);
                    if (hasRecord) dayDiv.classList.add('past-working');
                    else dayDiv.classList.add('past-missing');
                } else {
                    dayDiv.classList.add(tempOffDays.includes(i) ? 'off' : 'working');
                    if (currentDate.getDate() === today.getDate() && m === today.getMonth()) dayDiv.classList.add('today');
                    dayDiv.onclick = function() { toggleDayOff(i, dayDiv); };
                }
                container.appendChild(dayDiv);
            }
        }

        window.toggleDayOff = function(day, el) {
            if(tempOffDays.includes(day)) {
                tempOffDays = tempOffDays.filter(d => d !== day);
                el.classList.remove('off'); el.classList.add('working');
            } else {
                tempOffDays.push(day);
                el.classList.remove('working'); el.classList.add('off');
            }
            updateRentPreview();
        }

        window.updateRentPreview = function() {
            const total = parseFloat(document.getElementById('input-total-rent').value) || 0;
            const result = calculateTargetLogic(total, tempOffDays);
            
            document.getElementById('rent-preview-val').innerText = formatMoney(result.target);
            document.getElementById('rent-debug-remaining').innerText = formatMoney(result.remaining);
            document.getElementById('rent-debug-days').innerText = result.daysLeft;
        }

        window.calculateTargetLogic = function(totalRent, offDaysArray) {
            if(totalRent <= 0) return { target: 0, remaining: 0, daysLeft: 0 };
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const db = getDB();
            let paidSoFar = 0;
            db.forEach(item => { if(item.month === currentMonth && item.year === currentYear) paidSoFar += (item.rentPaid || 0); });

            const remainingToPay = Math.max(0, totalRent - paidSoFar);
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const today = now.getDate();
            
            let futureWorkDays = 0;
            for(let d = today; d <= daysInMonth; d++) {
                if(!offDaysArray.includes(d)) futureWorkDays++;
            }
            
            const target = futureWorkDays > 0 ? remainingToPay / futureWorkDays : remainingToPay;
            return { target: target, remaining: remainingToPay, daysLeft: futureWorkDays };
        }

        window.saveRentConfig = function() {
            const valStr = document.getElementById('input-total-rent').value;
            const total = parseFloat(valStr) || 0;
            // Mantendo config local por enquanto para simplificar, mas idealmente iria pro Firestore tamb√©m
            localStorage.setItem('rent_config', JSON.stringify({ total: total, offDays: tempOffDays }));
            alert("Planejamento Salvo!");
            closeRentConfig();
            
            const dashTarget = document.getElementById('dash-rent-target');
            if(dashTarget) {
                dashTarget.innerText = formatMoney(total);
                dashTarget.style.fontSize = "18px";
            }
            renderDashboard();
        }
        window.closeRentConfig = function() { document.getElementById('modal-rent').classList.add('hidden'); }

        // --- DASHBOARD ---
        window.renderDashboard = function() {
            const db = getDB(); // Usa o cache carregado do Firebase
            const m = viewDate.getMonth();
            const y = viewDate.getFullYear();
            document.getElementById('label-month').innerText = monthNames[m].toUpperCase();
            document.getElementById('label-year').innerText = y;

            const data = db.filter(i => (i.month !== undefined ? i.month === m && i.year === y : parseInt(i.date.split('/')[1])-1 === m));
            let tRev=0, tExp=0, tFuel=0, tFood=0, tRent=0, tHours=0, tKm=0;

            data.forEach(i => {
                tFuel += i.fuel||0; tFood += i.food||0; tRent += i.rentPaid||0;
                tExp += (i.fuel||0) + (i.food||0) + (i.rentPaid||0);
                tRev += (i.uber||0) + (i.pop||0);
                tHours += i.hours||0; tKm += i.km||0;
            });

            document.getElementById('dash-profit').innerText = formatMoney(tRev - tExp);
            document.getElementById('dash-rev').innerText = formatMoney(tRev);
            document.getElementById('dash-exp').innerText = formatMoney(tExp);
            document.getElementById('dash-fuel-val').innerText = formatMoney(tFuel);
            document.getElementById('dash-food-val').innerText = formatMoney(tFood);
            document.getElementById('dash-rent-val').innerText = formatMoney(tRent);
            document.getElementById('dash-fuel-pct').innerText = (tRev > 0 ? ((tFuel/tRev)*100).toFixed(1) : '0') + "%";
            
            const config = JSON.parse(localStorage.getItem('rent_config'));
            const total = config ? Number(config.total) : 0;
            const dashTargetEl = document.getElementById('dash-rent-target');
            if(total > 0) {
                dashTargetEl.innerText = formatMoney(total);
                dashTargetEl.style.fontSize = "18px";
            } else {
                dashTargetEl.innerText = "Definir Meta";
                dashTargetEl.style.fontSize = "14px";
            }

            document.getElementById('dash-hourly').innerText = formatMoney(tHours > 0 ? (tRev-tExp)/tHours : 0);
            document.getElementById('dash-hours').innerText = tHours.toFixed(1) + "h";
            document.getElementById('dash-km-val').innerText = formatMoney(tKm > 0 ? tRev/tKm : 0);
        }

        // --- HIST√ìRICO ---
        window.renderHistory = function() {
            const db = getDB(); 
            const list = document.getElementById('history-list'); 
            list.innerHTML = '';
            
            const groups = {};
            // Index agora se refere ao √≠ndice no array localData
            db.forEach((item, index) => {
                let m = item.month, y = item.year;
                if(m===undefined) { const p = item.date.split('/'); m=parseInt(p[1])-1; y=parseInt(p[2]); }
                const key = `${m}-${y}`;
                if(!groups[key]) groups[key] = { label: `${monthNames[m]} ${y}`, items: [] };
                item.originalIndex = index; // Importante para saber qual editar
                groups[key].items.push(item);
            });

            Object.keys(groups).forEach(key => {
                const g = groups[key];
                const folder = document.createElement('div'); folder.className = 'month-folder';
                folder.innerHTML = `<span class="folder-title">üìÇ ${g.label}</span><span class="folder-icon">‚ñº</span>`;
                const itemsDiv = document.createElement('div'); itemsDiv.className = 'days-list';
                g.items.forEach(d => {
                    const rec = (d.uber||0)+(d.pop||0), luc = rec - ((d.fuel||0)+(d.food||0)+(d.rentPaid||0));
                    
                    let hoursVal = d.hours > 0 ? luc/d.hours : 0;
                    let fuelPct = rec > 0 ? ((d.fuel||0)/rec)*100 : 0;
                    let tagsHtml = `<span class="tag tag-fuel">‚õΩ ${fuelPct.toFixed(0)}%</span>`;
                    if(d.hours) tagsHtml += `<span class="tag tag-hour" style="margin-left:5px;">‚è±Ô∏è ${d.hoursFormatted||d.hours+'h'} ‚Ä¢ ${formatMoney(hoursVal)}/h</span>`;

                    const div = document.createElement('div'); div.className = 'history-item';
                    
                    div.innerHTML = `
                        <div onclick="openDayDetail(${d.originalIndex})" style="flex:1;">
                            <div class="date-badge">${d.date}</div>
                            <div class="sub-info">Lucro: ${formatMoney(luc)} <br> ${tagsHtml}</div>
                        </div>
                        <div style="display:flex; align-items:center;">
                            <button onclick="askDelete(${d.originalIndex})" class="btn-trash">üóëÔ∏è</button>
                            <span onclick="openDayDetail(${d.originalIndex})" style="font-size:18px; color:#666; margin-left:10px;">‚ñ∂</span>
                        </div>`;
                    itemsDiv.appendChild(div);
                });
                folder.onclick = () => folder.classList.toggle('folder-open');
                list.appendChild(folder); list.appendChild(itemsDiv);
            });
        }

        // --- DETALHES, WIZARD E AUXILIARES ---
        window.openDayDetail = function(index) {
            window.history.pushState({modal: 'detail'}, "", ""); currentDetailIndex = index;
            const d = getDB()[index]; if(!d) return;
            const rec = (d.uber||0)+(d.pop||0), desp = (d.fuel||0)+(d.food||0)+(d.rentPaid||0), luc = rec-desp;
            
            document.getElementById('detail-title').innerText = `Detalhes: ${d.date}`;
            document.getElementById('day-profit').innerText = formatMoney(luc);
            document.getElementById('day-rev').innerText = formatMoney(rec);
            document.getElementById('day-exp').innerText = formatMoney(desp);
            document.getElementById('day-fuel-val').innerText = formatMoney(d.fuel||0);
            document.getElementById('day-food-val').innerText = formatMoney(d.food||0);
            document.getElementById('day-rent-val').innerText = formatMoney(d.rentPaid||0);
            document.getElementById('day-uber').innerText = formatMoney(d.uber||0);
            document.getElementById('day-pop').innerText = formatMoney(d.pop||0);
            document.getElementById('day-fuel-pct').innerText = (rec>0?((d.fuel||0)/rec)*100:0).toFixed(1)+'%';
            document.getElementById('day-hours').innerText = (d.hoursFormatted||(d.hours||0).toFixed(1))+"h";
            document.getElementById('day-hourly').innerText = formatMoney(d.hours>0?luc/d.hours:0);
            document.getElementById('day-km-val').innerText = formatMoney(d.km>0?rec/d.km:0);
            
            const config = JSON.parse(localStorage.getItem('rent_config'));
            const res = config ? calculateTargetLogic(config.total, config.offDays||[]) : { target: 0, remaining: 0, daysLeft: 0 };
            document.getElementById('day-rent-target-val').innerText = formatMoney(res.target);
            
            const displayDays = Math.max(0, res.daysLeft - 1);
            document.getElementById('day-rent-math-expl').innerText = `Faltam ${formatMoney(res.remaining)} para os ${displayDays} dias restantes`;

            document.getElementById('view-day-detail').classList.remove('hidden');
        }
        window.closeDayDetail = function() { document.getElementById('view-day-detail').classList.add('hidden'); }

        window.askDelete = function(index) { itemToDeleteIndex = index; document.getElementById('modal-delete').classList.remove('hidden'); }
        window.closeDeleteModal = function() { itemToDeleteIndex = null; document.getElementById('modal-delete').classList.add('hidden'); }
        
        window.startWizard = function(indexToEdit = null) {
            window.history.pushState({modal: 'wizard'}, "", "");
            const config = JSON.parse(localStorage.getItem('rent_config'));
            const res = config ? calculateTargetLogic(config.total, config.offDays || []) : {target:0};
            
            if(indexToEdit !== null) { 
                editingIndex = indexToEdit; 
                tempData = {...getDB()[indexToEdit]}; 
                const p = tempData.date.split('/'); 
                tempData.customDate = `${p[2]}-${p[1]}-${p[0]}`; 
            } else { 
                editingIndex = null; 
                tempData = {}; 
                tempData.customDate = new Date().toISOString().split('T')[0]; 
                tempData.rentPaid = res.target; 
            }
            currentStep = 0; toggleWizard(true); renderStep();
        }

        window.renderStep = function() {
            const s = steps[currentStep]; document.getElementById('step-counter').innerText = `ETAPA ${currentStep+1}/${steps.length}`;
            document.getElementById('progress-bar').style.width = `${((currentStep+1)/steps.length)*100}%`;
            document.getElementById('btn-next').innerText = (currentStep === steps.length - 1) ? 'SALVAR' : 'PR√ìXIMO';
            let val = tempData[s.id], html = s.type === 'date' ? `<input type="date" id="inp-val" class="step-input" value="${tempData.customDate}">` : s.type === 'time' ? `<input type="time" id="inp-val" class="step-input" style="color-scheme:dark;" value="${tempData.hoursFormatted||''}">` : `<input type="number" id="inp-val" class="step-input" placeholder="0" autofocus value="${val!==undefined && val!==0?val:''}">`;
            document.getElementById('wizard-content').innerHTML = `<div class="step-icon-circle">${s.icon}</div><h2>${s.title}</h2><p style="color:#888;">${s.label}</p>${html}`;
            if(s.id==='rentPaid' && val) {
                document.getElementById('inp-val').value = parseFloat(val).toFixed(2);
            }
            if(s.type!=='date'&&s.type!=='time') setTimeout(()=>document.getElementById('inp-val').focus(),100);
        }

        window.nextStep = function(skip) {
            const el = document.getElementById('inp-val'), s = steps[currentStep];
            if(s.type === 'date') tempData.customDate = el.value;
            else if(s.type === 'time') { if(skip||!el.value) tempData[s.id]=0; else { tempData.hoursFormatted=el.value; const [h,m]=el.value.split(':').map(Number); tempData[s.id]=h+(m/60); } }
            else tempData[s.id] = skip ? 0 : (parseFloat(el.value)||0);
            if(currentStep < steps.length - 1) { currentStep++; renderStep(); } else saveEntry();
        }

        window.editCurrentDay = function() { closeDayDetail(); startWizard(currentDetailIndex); }
        window.toggleWizard = function(show) { const el = document.getElementById('wizard-overlay'); if(show) el.classList.remove('hidden'); else el.classList.add('hidden'); }
        window.prevStep = function() { if(currentStep > 0) { currentStep--; renderStep(); } }
        
        window.switchTab = function(tab) {
            document.querySelectorAll('#view-dashboard, #view-history').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            if(tab === 'home') { document.getElementById('view-dashboard').classList.remove('hidden'); document.getElementById('nav-home').classList.add('active'); renderDashboard(); }
            else { window.history.pushState({page: 'history'}, "", ""); document.getElementById('view-history').classList.remove('hidden'); document.getElementById('nav-hist').classList.add('active'); renderHistory(); }
        }

        window.changeMonth = function(dir) { viewDate.setMonth(viewDate.getMonth() + dir); renderDashboard(); }
        window.formatMoney = function(n) { return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); }

    </script>
